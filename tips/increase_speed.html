
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">


<head profile="http://purl.org/net/ns/metaprof">
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <meta http-equiv="content-style-type" content="text/css" />

 <title>Tips/高速化 - AYAYA/03</title>
 <link rel="stylesheet" href="skin/default.css" type="text/css" media="screen" charset="UTF-8" />
 <link rel="stylesheet" href="skin/print.css" type="text/css" media="print" charset="UTF-8" />
 <link rel="stylesheet" href="/svgd/table.css" type="text/css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="index.php?cmd=mixirss&amp;ver=0.91" /> 
 <script type="text/javascript">
 <!--
 // -->
 IMAGE_DIR = 'image/';
 SKIN_DIR = 'skin/';
 </script>
<!-- <script type="text/javascript" src="skin/lang/.js"></script> -->
<script type="text/javascript" src="skin/default.js"></script>
<!-- <script type="text/javascript" src="skin/ajax/textloader.js"></script> -->
<!-- <script type="text/javascript" src="skin/ajax/glossary.js"></script> -->
 <script type="text/javascript" src="skin/tzCalculation_LocalTimeZone.js"></script>

</head>

<body>

<div id="interface_header"></div>

<div id="interface_content">
   <div id="body"><h2 id="content_1_0">高速化チューニング<a class="anchor_super" id="y02b92c0" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#y02b92c0" style="user-select:none;">&dagger;</a></h2>
<p><strong>警告！</strong>ここにある修正を加えなくても、通常は全く問題ありません。<br />
予期しないトラブルの可能性もありますので、注意して利用してください。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_1">はじめに<a class="anchor_super" id="r328f110" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#r328f110" style="user-select:none;">&dagger;</a></h3>
<p>ヒトバシラ上等！な方に贈る、AYAv5用高速化チューニング。<br />
イラチな方に最適です。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_2">起動を高速化する<a class="anchor_super" id="b66b7447" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#b66b7447" style="user-select:none;">&dagger;</a></h3>
<p>AYA利用ゴーストは、等しく起動が遅い！という難点を抱えていることが多く、悩みの種の方も多いでしょう。ここでは、起動高速化に関する簡単なチューニングを扱います。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_3">たくさんゴーストをインストールした環境で起動が遅い<a class="anchor_super" id="u77ecfb5" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#u77ecfb5" style="user-select:none;">&dagger;</a></h4>
<p>総ゴースト数が4桁程度まで膨れ上がった昨今、3桁レベルのインストール数の環境も多いかと思います。
……それは良いのですが、本体側からのゴースト情報の通知も巨大になり、その解析にAYAが手間取るという難儀な問題も出てしまいます。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_4">かんたんなTips<a class="anchor_super" id="k9b54765" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#k9b54765" style="user-select:none;">&dagger;</a></h4>
<p><strong>人柱度</strong>：★★☆☆☆</p>
<p>解決方法は簡単で、aya_shiori3.dicの最初の方にある #define の並びのうちいくつかを</p>
<pre>#define IGLIST_MAX 0
#define REQUEST_LINES_LIMIT 30</pre>
<p>などのように修正します。</p>
<dl class="list1 list-indent1"><dt>IGLIST_MAX</dt>
<dd>本体に頼らず、AYAが内部でひたすらインストール済みゴーストの情報を探索する機能があります。それを有効にするかどうかを示し、0で無効、-1で無制限です。必要ない場合は無効で全く問題ありません。</dd></dl>
<dl class="list1 list-indent1"><dt>REQUEST_LINES_LIMIT</dt>
<dd>本体とゴーストの間の通信は、何行にもわたる文字列で行われます。この設定は、それを解析する行数に制限をかけることで、大量の通知の解析を手間取らないようにしよう、という考えから生まれたものです。</dd></dl>
<p>なお、インストール済みのゴースト/バルーンなどの情報を扱いたいゴーストでは、これらの設定変更をするとトラブルの元になります。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_5">もうちょっとやってみたい人向けTips<a class="anchor_super" id="e5ac9819" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#e5ac9819" style="user-select:none;">&dagger;</a></h4>
<p><strong>人柱度</strong>：★★★★☆</p>
<p>……さて、それでもまだ我慢ならねぇ！という方向けTips。ゴースト情報取得自体を無効にしてしまいましょう。</p>
<p>aya_shiori3.dicの600行目以降あたりに、On_installedghostnameというものがあるかと思います。これを全てコメントアウトしてしまいます。</p>
<pre>/*On_installedghostname
{
    (ごにょごにょ)
}*/</pre>
<p>こんな感じですね。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_6">ランダムトークの出るのが遅い<a class="anchor_super" id="b6a0e2f5" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#b6a0e2f5" style="user-select:none;">&dagger;</a></h3>
<p>ついに力作が完成！なんとランダムトークが数百個もあるゾ！！<br />
……でも、遅いんだけどこれ……</p>
<p>という、ある種特殊な方向け高速化Tipsです。</p>
<p>サポート掲示板か日記あたりでumeiciさんが言っていたTipsの発展形です。最新のAYAで可能になりました。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_7">シングルクオートによる高速化<a class="anchor_super" id="edcac7cd" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#edcac7cd" style="user-select:none;">&dagger;</a></h4>
<p><strong>人柱度</strong>：★★★★☆</p>
<p>ランダムトークは多分aya_aitalk.dicに書いているかと思います。</p>
<pre>RandomTalk
{
   &quot;ごにょごにょ&quot;
}</pre>
<p>こんな感じですね。</p>
<p>&quot; &quot; でくくって、SakuraScriptをナマでずらずら書いていくわけですが、実は新しいバージョンのAYAでは、&quot; &quot; 以外にも ' ' が使えるようになりました。</p>
<p>なんでそれが関係あるの！という説明の前に、先に変更例を書いてみます。<br />
とりあえず理屈はええからすぐ使いたい！という人は、これをコピペして使ってください。</p>
<pre>RandomTalk
{
    TOSTR(EVAL(CHR(0x22)+RandomTalkEx()+CHR(0x22)))
}

RandomTalkEx
{
    'ごにょごにょ'
}</pre>
<p>はい、元あったRandomTalkの名前を適当に(RandomTalkExとしました)変えて、中身の文章の囲み方を ' ' に変えて、妙な命令のあるRandomTalkをつけくわえただけです。<a id="notetext_1" href="#notefoot_1" class="note_super" title="外側のTOSTRはたぶんいらないと思いますけど念のためです。気になる方はひっぺがして下さい。">*1</a></p>
<p>……それでは、からくりを説明します。</p>
<p>AYA5の新しいバージョンで導入された ' ' の意味は、<strong>%()を展開しない</strong>です。<br />
詳しくはAYAのマニュアルを見てほしいのですが、%hogehoge、やら、%(hogehoge)、やらで適当に変数やら関数やら式やらを埋め込めるという機能が、' ' 囲みにするとすべて無効になります。</p>
<p>元の &quot; &quot; の状態では、埋め込みする処理をすべて解析して結果とする処理が必要なのですが、' ' ですと囲まれた部分はただの文字列扱いですので、ほとんど何も処理する必要がありません。</p>
<p>ここでAYAの挙動を思い出していただきたいのですが、関数内にあるものはすべて評価されて、そのうちの1つがランダム（またはオプションに応じてどれか1つ）結果とされます。</p>
<p>……というややこしい話はほったらかして、要するに、<strong>ランダムトークをン百個書いたら%()の処理もン百回しなきゃならん</strong>ということで、重くなるのは想像できるかと思います。<a id="notetext_2" href="#notefoot_2" class="note_super" title="AYAの本当の内部処理を知っている方からツッコミが入りそうですが、ここでは分かりやすい説明にとどめました">*2</a></p>
<p>さて、これでRandomTalkExと名前を変えた部分の説明は終わりですが、このままですと%()の中身がちゃんと埋め込まれないという事態になってしまいます。これを解決するのが、</p>
<pre>TOSTR(EVAL(CHR(0x22)+RandomTalkEx()+CHR(0x22)))</pre>
<p>というわけです。TOSTRは「文字列として扱いなさい」という命令ですがここでは深い意味はありません。<strong>キモはEVALとその括弧の中身です</strong>。</p>
<p>EVALは「括弧でくくって渡された中身をAYAのスクリプトとして実行しなさい」という命令です。そして、CHR(0x22)は &quot; のことです。</p>
<p>……何が起こっているのか大体読めてきたと思います。EVALが実行するスクリプトは、</p>
<pre>&quot; + RandomTalkExの結果 + &quot;</pre>
<p>となり、%()の埋め込み処理を行う式を作っています。<br />
延々ン百回も%()の処理をしなければならなかったものが、このEVALで囲まれた部分の1回分で済むわけで、これが軽くなるカラクリですね。</p>

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h3 id="content_1_8">もっとマニアックに攻めてみたい方向け<a class="anchor_super" id="f7cfea56" href="index.php?Tips/%E9%AB%98%E9%80%9F%E5%8C%96#f7cfea56" style="user-select:none;">&dagger;</a></h3>
<p>ほかのゴーストに使える形ではない高速化の工夫などは</p>
<p><a href="http://ssp.shillest.net/ghost.html" rel="nofollow">http://ssp.shillest.net/ghost.html</a></p>
<p>のEmily/Phase4にいろいろ導入されています。見本にするにはかなりキチャナイ辞書ではありますが、話のネタにはなるかと思います（苦笑）</p>
   
   	 	
	</div>
</div>

<div id="note">
<hr class="note_hr" /><a id="notefoot_1" href="#notetext_1" class="note_super">*1</a>
<span class="small">外側のTOSTRはたぶんいらないと思いますけど念のためです。気になる方はひっぺがして下さい。</span><br />
<a id="notefoot_2" href="#notetext_2" class="note_super">*2</a>
<span class="small">AYAの本当の内部処理を知っている方からツッコミが入りそうですが、ここでは分かりやすい説明にとどめました</span><br /></div>



<table cellspacing=0 width=100%>
<tr><td id=footer>


<div id="lastmodified">
 Last modified on: 2006-12-09 (Saturday) 14:41:58<span class="page_passage"></span></div>




</td></tr>
</table>

<div id="interface_footer"></div>

<script src="interface.js"></script>

</body>
</html>
